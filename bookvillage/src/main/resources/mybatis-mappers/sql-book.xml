<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mi.bookvillage.book.model.dao.BookDAO">

    <select id="getBookList" resultType="BookVO">
        SELECT *
          FROM BOOK
    </select>


    <select id="getBookDetail" resultType="BookVO">
        SELECT BOOK_SEQ,
               BOOK_TITLE,
               BOOK_PRICE,
               BOOK_RENTAL_FEE,
               BOOK_MEMO,
               DATE_FORMAT(BOOK_REG_DT, '%Y-%m-%d %H:%i') AS BOOK_REG_DT,
               BOOK_UPDATE_DT
         FROM BOOK
        WHERE BOOK_SEQ = #{bookSeq}
    </select>


    <insert id="addBook" useGeneratedKeys="true" keyProperty="bookSeq">
        INSERT INTO BOOK (
                          BOOK_TITLE,
                          BOOK_PRICE,
                          BOOK_RENTAL_FEE,
                          BOOK_MEMO
                          )
                   VALUES (
                           #{bookTitle},
                           #{bookPrice},
                           #{bookRentalFee},
                           #{bookMemo}
                          )
    </insert>


    <insert id="addFile">
        INSERT INTO BOOK_FILE(
                                BOOK_SEQ,
                                ORIGIN_FILE_NAME,
                                RENAME_FILE_NAME,
                                SAVE_PATH
                                )
                        VALUES (
                                   #{bookSeq},
                                   #{originFileName},
                                   #{renameFileName},
                                   #{savePath}
                               )
    </insert>


    <select id="getBookFile" resultType="com.mi.bookvillage.common.util.file.FileVO">
        SELECT FILE_SEQ,
               BOOK_SEQ,
               ORIGIN_FILE_NAME,
               RENAME_FILE_NAME,
               SAVE_PATH,
               REG_DATE
         FROM BOOK_FILE
        WHERE BOOK_SEQ = #{bookSeq}
    </select>


    <update id="updateBook" parameterType="BookVO">
        UPDATE BOOK
           SET BOOK_TITLE = #{bookTitle},
               BOOK_PRICE = #{bookPrice},
               BOOK_RENTAL_FEE = #{bookRentalFee},
               BOOK_MEMO = #{bookMemo},
               BOOK_UPDATE_DT = NOW()
         WHERE BOOK_SEQ = #{bookSeq}
    </update>


    <delete id="deleteBook">
        DELETE
          FROM BOOK
         WHERE BOOK_SEQ = #{bookSeq}
    </delete>


    <delete id="deleteFilesWithBook">
        DELETE
        FROM BOOK_FILE
        WHERE BOOK_SEQ = #{bookSeq}
    </delete>


    <delete id="deleteFiles">
        DELETE
          FROM BOOK_FILE
         WHERE FILE_SEQ = #{fileSeq}
    </delete>












</mapper>